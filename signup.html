<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!----======== CSS ======== -->
    <link rel="stylesheet" href="./style/global.css">
    <link rel="stylesheet" href="./style/signup.css">
    <!----===== Iconscout CSS ===== -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <title>Responsive Registration Form</title>
</head>
<body>
    <div class="container">
        <header>Cadastro</header>

        <form action="./actions/add_user.php" method="POST">
            <div class="form first">
                <div class="details personal">
                    <span class="title">Detalhes Pessoais</span>

                    <div class="fields">
                        <div class="input-field">
                            <label>Nome</label>
                            <input type="text" id="name" name="name" placeholder="Digite seu nome" required minlength="3" maxlength="100">
                        </div>

                        <div class="input-field">
                            <label>Email</label>
                            <input type="email" id="email" name="email" placeholder="Digite seu email" required>
                        </div>

                        <div class="input-field">
                            <label>Telefone (DDI + DDD)</label>
                            <input type="tel" id="phone" name="phone" placeholder="+5500xxxxxxxxx" minlength="14" maxlength="14">
                        </div>

                        <div class="input-field">
                            <label>CPF</label>
                            <input type="text" id="cpf" name="cpf" placeholder="Digite seu CPF" minlength="11" maxlength="14" oninput="validateCPF()">
                            <span id="cpfValidationMessage" style="color: red; font-size: 10px; padding-left: 15px;"></span>
                        </div>
                        
                        <div class="input-field">
                            <label>CEP</label>
                            <input type="text" id="cep" name="cep" placeholder="Digite seu CEP" minlength="8" maxlength="8" oninput="searchCEP()">
                        </div>

                        <div class="input-field">
                            <label>Endereço</label>
                            <input type="text" id="address" name="address" placeholder="Digite seu endereço" minlength="5" maxlength="255">
                        </div>

                        <div class="input-field">
                            <label>Bairro</label>
                            <input type="text" id="district" name="district" placeholder="Digite seu bairro" minlength="3" maxlength="100">
                        </div>

                        <div class="input-field">
                            <label>Cidade</label>
                            <input type="text" id="city" name="city" placeholder="Digite sua cidade" minlength="3" maxlength="100">
                        </div>

                        <div class="input-field">
                            <label>UF</label>
                            <input type="text" id="uf" name="uf" placeholder="Digite sua UF" minlength="2" maxlength="2">
                        </div>

                        <div class="input-field">
                            <label>Data de Nascimento</label>
                            <input type="date" id="birth" name="birth" placeholder="Digite sua data de nascimento" required>
                        </div>

                        <div class="input-field">
                            <label>Senha</label>
                            <input type="password" id="psw" name="psw" placeholder="Digite sua senha" required minlength="6" maxlength="30">
                        </div>

                        <div class="input-field">
                            <label>Confirmar Senha</label>
                            <input type="password" id="confirm_psw" name="confirm_psw" placeholder="Confirme sua senha" required minlength="6" maxlength="30">
                        </div>
                    </div>
                </div>

                <button type="submit">
                    <span class="btnText">Cadastrar</span>
                </button>
            </div>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const errorMessage = localStorage.getItem('signupError');
        if (errorMessage) {
            Swal.fire({
                icon: 'error',
                title: 'Erro!',
                text: errorMessage,
                position: 'bottom-right',
                timer: 5000,
                toast: true,
                showConfirmButton: false
            });
            localStorage.removeItem('signupError'); // Remove a mensagem após exibir
        }
    });
</script>


    <script>
        function searchCEP() {
            const cep = document.getElementById('cep').value.replace('-', '');
            if (cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById('address').value = data.logradouro;
                            document.getElementById('district').value = data.bairro;
                            document.getElementById('city').value = data.localidade;
                            document.getElementById('uf').value = data.uf;
                        } else {
                            alert('CEP não encontrado.');
                        }
                    })
                    .catch(error => console.error('Erro ao buscar CEP:', error));
            }
        }

        function validateCPF() {
            const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
            const messageElement = document.getElementById('cpfValidationMessage');

            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) {
                messageElement.textContent = "CPF inválido!";
                document.getElementById('cpf').style.border = '1px solid red';
                return;
            }

            let sum = 0;
            let remainder;

            // Validando primeiro dígito
            for (let i = 1; i <= 9; i++) {
                sum += parseInt(cpf[i - 1]) * (11 - i);
            }
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) {
                remainder = 0;
            }
            if (remainder !== parseInt(cpf[9])) {
                messageElement.textContent = "CPF inválido!";
                document.getElementById('cpf').style.border = '1px solid red';
                return;
            }

            // Validando segundo dígito
            sum = 0;
            for (let i = 1; i <= 10; i++) {
                sum += parseInt(cpf[i - 1]) * (12 - i);
            }
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) {
                remainder = 0;
            }
            if (remainder !== parseInt(cpf[10])) {
                messageElement.textContent = "CPF inválido!";
                document.getElementById('cpf').style.border = '1px solid red';
                return;
            }

            messageElement.textContent = "";
            ocument.getElementById('cpf').style.border = '1px solid green'; // Borda verde para CPF válido
        }
    </script>
</body>
</html>
